{% extends "base.html" %}


{% block content %}
<div class="container">
  <h2 class="text-center">
    Добро пожаловать в панель мониторинга
    <a href="{{ url_for('ovpn') }}" class="fancy-link">OpenVPN</a> и
    <a href="{{ url_for('wg') }}" class="fancy-link">WireGuard</a>
  </h2>

  <p class="text-center">
    Это приложение позволяет отслеживать статистику подключений и трафика для серверов OpenVPN и WireGuard.
  </p>

  <div class="mt-3 p-3 border rounded" style="margin: auto;">
    <h4 class="text-center">Системные метрики:</h4>
    <p class="text-center text-muted small">
      Сервер:
      <span class="text-success">{{ server_ip }}</span>@{{ hostname }}
    </p>
    <div class="row">
      <div class="col-12 mb-3">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Клиенты онлайн:</h5>
            <p class="card-text" id="vpn_clients">
              <a class="text-decoration-none" href="{{ url_for('ovpn') }}">&#128279; <b>OpenVPN</b></a>:
              {{ system_info.vpn_clients['OpenVPN'] if system_info and system_info.vpn_clients else 0 }}
              шт.<br>
              <a class="text-decoration-none" href="{{ url_for('wg') }}">&#128279; <b>WireGuard</b></a>:
              {{ system_info.vpn_clients['WireGuard'] if system_info and system_info.vpn_clients else 0 }}
              шт.
            </p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 mb-3">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Время работы сервера:</h5>
            <p class="card-text"><span id="server_uptime">Загрузка...</span></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 mb-3">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Использование диска:</h5>
            <p class="card-text">
              <span id="disk_used">Загрузка...</span> GB /
              <span id="disk_total">{{ system_info.disk_total }}</span> GB
            </p>
          </div>
        </div>
      </div>
      <div class="col-12 mb-3">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0">Текущая нагрузка ЦП / ОЗУ:</h5>
              <a id="toggleCpuChartBtn" class="btn btn-sm btn-outline-secondary " title="Показать график">
                <i class="bi bi-graph-up"></i>
              </a>
            </div>
              <span class="card-title">ЦП:</span>
              <span class="card-text"><span id="cpu_load">Загрузка...</span>%</span><br>
              <span class="card-title">ОЗУ:</span>
              <span class="card-text">
                <span id="memory_used">Загрузка...</span> MB /
                <span id="memory_total">{{ system_info.memory_total }}</span> MB
              </span>

          </div>
        </div>
      </div>
      <div class="col-12 mb-3" id="cpuChartContainer" style="display: none;">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2">
              <h5 class="card-title mb-0">График ЦП / ОЗУ:</h5>
              <div id="cpu-period-filters" class="overflow-auto btn-group btn-group-sm" role="group">
                <button class="btn btn-outline-secondary cpu-period active" data-period="live">Live</button>
                <button class="btn btn-outline-secondary cpu-period" data-period="hour">Час</button>
                <button class="btn btn-outline-secondary cpu-period" data-period="day">Сутки</button>
                <button class="btn btn-outline-secondary cpu-period" data-period="week">Неделя</button>
              </div>
            </div>
            <div class="mt-2">
              <canvas id="cpuChart" height="250"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 mb-3">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0">Текущая сетевая загрузка:</h5>
              <a id="toggleChartBtn" class="btn btn-sm btn-outline-secondary " title="Показать график">
                <i class="bi bi-graph-up"></i>
              </a>
            </div>
            <div id="network_load" class="mt-2">Загрузка...</div>
          </div>
        </div>
      </div>
      <div class="col-12 mb-3" >
        <div class="card" id="bwChartContainer" style="display: none;">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2">
              <div id="interface-filters" class="overflow-auto btn-group btn-group-sm" style="white-space: nowrap;"
                role="group"></div>
              <div id="period-filters" class="overflow-auto btn-group btn-group-sm" role="group">
                <button class="btn btn-outline-secondary period" data-period="hour">Час</button>
                <button class="btn btn-outline-secondary period" data-period="day">Сутки</button>
                <button class="btn btn-outline-secondary period" data-period="week">Неделя</button>
                <button class="btn btn-outline-secondary period" data-period="month">Месяц</button>
              </div>
            </div>
            <div class="d-flex align-items-center mb-2">
              <span class="text-muted me-2">График интерфейса: </span>
              <code id="bwIface">—</code>
            </div>
            <canvas id="bwChart" height="130"></canvas>
          </div>
        </div>
      </div>

      <div class="mt-4">
        <h4 class="text-center mb-4">
          Статистика по интерфейсу: <span id="network_interface">Загрузка...</span>
        </h4>
        <div class="row">
          <div class="col-12 col-md-6 mb-3">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Принятые данные:</h5>
                <p class="card-text"><span id="rx_bytes">Загрузка...</span></p>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-6 mb-3">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Переданные данные:</h5>
                <p class="card-text"><span id="tx_bytes">Загрузка...</span></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="{{ url_for('static', filename='js/main_page.js') }}"></script>

  {% endblock %}